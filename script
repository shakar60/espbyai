-- Configuration
local HighlightColor = Color3.fromRGB(255, 0, 0) -- Red color for highlighting
local OutlineColor = Color3.fromRGB(0, 0, 0) -- Black color for outline
local NameTextSize = 14 -- Size of the player's name (medium size)

-- Function to create the highlight for a player
local function createHighlight(player)
    -- Check if the player has a character and humanoid
    local character = player.Character
    if character and character:FindFirstChildOfClass("Humanoid") then
        local humanoid = character:FindFirstChildOfClass("Humanoid")
        local head = character:FindFirstChild("Head")

        if humanoid and head then
            -- Iterate through each body part of the character
            for _, bodyPart in ipairs(character:GetChildren()) do
                if bodyPart:IsA("BasePart") then
                    -- Create an outline for the player's character
                    local outline = Instance.new("SelectionBox")
                    outline.Name = "Outline"
                    outline.Adornee = bodyPart
                    outline.Color3 = OutlineColor
                    outline.LineThickness = 0.1
                    outline.SurfaceTransparency = 1
                    outline.Parent = bodyPart

                    -- Create a highlight for the player's body
                    local highlight = Instance.new("BoxHandleAdornment")
                    highlight.Name = "Highlight"
                    highlight.Adornee = bodyPart
                    highlight.AlwaysOnTop = true
                    highlight.Color3 = HighlightColor
                    highlight.Size = bodyPart.Size * 1.1 -- Make the highlight slightly larger than the body part
                    highlight.Transparency = 0.3 -- Less transparent
                    highlight.ZIndex = 5
                    highlight.Parent = bodyPart
                end
            end

            -- Create a billboard GUI for the player's name
            local billboard = Instance.new("BillboardGui")
            billboard.Name = "NameTag"
            billboard.Size = UDim2.new(0, 150, 0, 30) -- Slightly bigger size
            billboard.StudsOffset = Vector3.new(0, 2, 0) -- Offset the name tag slightly above the player's head
            billboard.Parent = head

            local nameLabel = Instance.new("TextLabel")
            nameLabel.Name = "NameLabel"
            nameLabel.Size = UDim2.new(1, 0, 1, 0)
            nameLabel.BackgroundTransparency = 1
            nameLabel.TextColor3 = Color3.new(1, 1, 1)
            nameLabel.Text = player.Name
            nameLabel.Font = Enum.Font.SourceSansBold
            nameLabel.TextSize = NameTextSize
            nameLabel.Parent = billboard

            -- Create particle emitter for smoke effect
            local particleEmitter = Instance.new("ParticleEmitter")
            particleEmitter.Color = ColorSequence.new(Color3.fromRGB(100, 100, 100)) -- Gray particles
            particleEmitter.LightEmission = 0.5
            particleEmitter.Size = NumberSequence.new({NumberSequenceKeypoint.new(0, 0), NumberSequenceKeypoint.new(1, 5)}) -- Varying size
            particleEmitter.Speed = NumberRange.new(1, 2)
            particleEmitter.Rate = 20
            particleEmitter.Lifetime = NumberRange.new(1)
            particleEmitter.Rotation = NumberRange.new(0, 360)
            particleEmitter.RotSpeed = NumberRange.new(-100, 100)
            particleEmitter.Texture = "rbxassetid://7716160" -- Smoke texture
            particleEmitter.Transparency = NumberSequence.new(0, 0.5)
            particleEmitter.Acceleration = Vector3.new(0, 5, 0) -- Smoke rises
            particleEmitter.Parent = character

            -- Connect to the player removing event
            player.CharacterRemoving:Connect(function()
                for _, bodyPart in ipairs(character:GetChildren()) do
                    if bodyPart:IsA("BasePart") then
                        bodyPart:FindFirstChild("Outline"):Destroy()
                        bodyPart:FindFirstChild("Highlight"):Destroy()
                    end
                end
                billboard:Destroy()
                particleEmitter:Destroy()
            end)
        end
    end
end

-- Function to initialize highlights for all existing players
local function initHighlights()
    for _, player in ipairs(game.Players:GetPlayers()) do
        if player ~= game.Players.LocalPlayer then
            createHighlight(player)
        end
    end
end

-- Initialize highlights for existing players
initHighlights()

-- Connect to player added event to initialize highlights for new players
game.Players.PlayerAdded:Connect(function(player)
    if player ~= game.Players.LocalPlayer then
        createHighlight(player)
    end
end)
